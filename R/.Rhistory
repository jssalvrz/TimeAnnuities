theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x", space = "free_x",  labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",   labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year,  space = "free_x",  labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",
space = "free_x",
)+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",
space = "free_x"
)+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",
space = "free_x"
)+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",
space = "free_x"
)+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free_x",
space = "free_x",ncol = 2
)+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year,
space = "free_x"    )+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_wrap(~Year, ncol=2, labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free", labeller = as_labeller(yearsLabels))+
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(4,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(3,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeathAlternate.svg", width = 7, height = 5)
ggsave("Fig/attributionCauseOfDeathAlternate.svg", width = 7, height = 3)
ggsave("Fig/attributionCauseOfDeath2.svg", width = 6, height = 5)
ggsave("Fig/attributionCauseOfDeath2.svg", width = 6, height = 3)
ggsave("Fig/attributionCauseOfDeath2.svg", width = 8, height = 3)
ggsave("Fig/attributionCauseOfDeath2.svg", width = 8, height = 2)
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free", labeller = as_labeller(yearsLabels)
)+ #
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(3,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeath2.svg", width = 8, height = 2)
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free", labeller = as_labeller(yearsLabels)
)+ #
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(4,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeath2.svg", width = 8, height = 2)
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(3,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeath2.svg", width = 8, height = 2)
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(3,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeathInLine.svg", width = 8, height = 2)
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeathInLine.svg", width = 8, height = 2)
rm(list = ls())
library(tidyverse)
library(data.table)
library(hrbrthemes)
library(msm)
library(mltools)
library(pracma)
library(splines)
library(hrbrthemes)
library(lemon)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("Decomp_FUN.R")
# Load data ---------------------------------------------------------------
# Historical data
load("C:/Git/TimeAnnuities/Data/SmoothedData.RData")
rawRates <- aRate
aRate <- aRate[,c("Year", "sdelta")]
names(aRate)[2] <- "delta" # Smoothed delta
aRate <- subset(aRate, Year<=2021)
# Historical data
hmxr <- data.table(merge(hmx,aRate, by = "Year"))
hmxr <- hmxr[,c("country", "Sex", "Year","Age", "Mx", "delta")]
smxr <- rbind(hmxr) # This is the full dataset
smxr <- data.table(arrange(smxr, country, Sex, Year, Age))
x <- 65 # Age to calculate annuities
Syear <- 1860
Fyear <- 2024# Final year to plot graphs
smxr <- subset(smxr, Age>=x) # Selection of interval
a <- smxr[, get.ax(Age = Age, mu = Mx, delta = delta), by = list(country,Sex, Year)]
rho <- a[, get.rho(mx = mu, Year= Year, Age= Age), by = list(country, Sex)]
phi <- get.phi(delta = aRate$delta, Year = aRate$Year)
a <- merge(a, rho, by = c("country", "Sex", "Year", "Age"))
a <- merge(a, phi, by = c("Year"))
adot <- subset(a)[, get.adot(ax=ax,Year=Year), by = list(country, Sex, Age)]
names(adot)[5] <- "adotc"
adotD <- a[,get.decomp(Age=Age, ax=ax, sEx=sEx, mu=mu,
delta=delta, rho=rho, phi=phi, H=Hp,D=Dp,Dc=Dc),
by = list(country,  Sex, Year)]
adotD <- as.data.frame(arrange(adotD, country, Sex, Year))
adotD <- merge(adotD, aRate, by = "Year")
adotD <- merge(adotD, phi, by = "Year")
adotD$intc <- adotD$phibar * adotD$delta *adotD$Dc
adotD$Dp2 <- adotD$delta *adotD$Dc # Check Duration Prop changes
View(phi)
View(rawRates)
0.040669581-0.026912251
(0.040669581-0.026912251)*100
(0.026912251-0.040669581)/0.040669581
