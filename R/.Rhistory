Fyear <- 2024# Final year to plot graphs
ii <- c( "#006140", "#00bd7d","#92f7ae", "#bdffeb" )
kk <- c( "#ba3c06", "#d4742f", "#ffa463", "#ffdec7")
jj<- c(ii,kk)
ggplot(subset(adotD.age, Sex == "Males"))+
#geom_area( aes( Year, Percentage*100, fill = Component),position = "stack", alpha =1)+
geom_bar(aes(x= Year, y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 1, alpha = 1)+
scale_fill_manual(values = jj)+
facet_wrap(~Sex)+
scale_y_continuous(breaks = seq(-10,10,by = 2), expand = c(0,0))+
scale_x_continuous(breaks = brks,labels = labs, expand = c(0,0))+
theme_minimal()+
coord_cartesian(ylim = c(-6,6), xlim=c(Syear,Fyear))+
theme(panel.grid = element_blank(),
panel.background = element_blank(),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
aspect.ratio = 1,
strip.text = element_blank(),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")
# Load data ---------------------------------------------------------------
# Mortality data
load("C:/Git/TimeAnnuities/Data/SmoothedData.RData")
# Term structure of interest rates
rstr <- as.data.frame(read_csv("C:/Git/TimeAnnuities/Data/Interest rates/Term Structure/Processed_Term_Structure.csv"))
# Extract year of each term-struc
rstr$Year <- as.integer(year(rstr$date))
# Average by year
rstr <- rstr %>% group_by(Year,term)  %>% summarize(rawdelta = mean(forward_force))
rstr$term  <- rstr$term - 1 # To start at age 0, e.g. age 65
# smooth rates over the term and over time
years <- 1970:2024
rsm <- data.table(rstr)
rsm <- rsm[,smooth.spline(rawdelta, spar = 0)$y,by = Year ]
rsm$term <- rstr$term
rsm1 <- as.data.frame(rsm[,smooth.spline(V1, spar = 0.52)$y,by = term ])
rsm1$Year <- years
rstr1 <- merge(rstr, rsm1, by = c("Year", "term"))
names(rstr1)[4] <- "delta"
rstr1 <- arrange(rstr1, Year, term)
rsm2 <- as.data.frame(rsm[,smooth.spline(V1, spar = 0.42)$y,by = term ])
rsm2$Year <- years
rstr2 <- merge(rstr, rsm2, by = c("Year", "term"))
names(rstr2)[4] <- "delta"
rstr2 <- arrange(rstr2, Year, term)
yearcutoff <- 2015
rstr <- as.data.frame(rbind(subset(rstr1, Year<=yearcutoff),subset(rstr2, Year>yearcutoff) ))
# Merge interest rates with mortality data
x <- 65 # Age to calculate annuities
rstr$Age <- rstr$term + x
hmxr <- merge(hmx,rstr, by = c("Year", "Age"))
hmxr <- hmxr[,c("country", "Sex", "Year","Age","term", "Mx", "delta")]
hmxr <- data.table(arrange(hmxr, country, Sex, Year, Age))
a <- hmxr[, get.ax(Age = Age, mu = Mx, delta = delta), by = list(country,Sex, Year)]
rho <- a[, get.rho(mx = mu, Year= Year, Age= Age), by = list(country, Sex)]
# This function is the one that captures the term structure of interest rates
phi <- a[, get.phi.str(delta = delta, Year= Year, Age= Age), by = list(country, Sex)]
a <- merge(a, rho, by = c("country", "Sex", "Year", "Age"))
a <- merge(a, phi, by = c("country", "Sex", "Year", "Age"))
a.age <- a
a.age$xt <- case_when(a.age$Age %in% c(65:74) ~1,
a.age$Age %in% c(75:84) ~2,
a.age$Age %in% c(85:94) ~3,
a.age$Age %in% c(95:104)~4)
adotD.a <- a.age[,get.age.decomp(Age=Age, ax=ax, sEx=sEx, mu=mu,
delta=delta, rho=rho, phi=phi),
by = list(country,  Sex, Year, xt)]
adotD.age <- adotD.a[,c("country","Sex","Year","mort","int", "xt")] %>% filter() %>%
gather(Component, Percentage, -country, -Sex, -Year, -xt)
adotD.age$Component <- paste(adotD.age$Component, adotD.age$xt, sep= "")
adotD.age <- arrange(adotD.age, Sex,  Year)
adot <- a[, get.adot(ax=ax,Year=Year), by = list(country, Sex, Age)]
names(adot)[5] <- "adotc"
adotD <- a[,get.decomp(Age=Age, ax=ax, sEx=sEx, mu=mu,
delta=delta, rho=rho, phi=phi, H=Hp,D=Dp,Dc=Dc),
by = list(country,  Sex, Year)]
adotD <- as.data.frame(arrange(adotD, country, Sex, Year))
# Figures -----------------------------------------------------------------
brks <- seq(1970,2020,by = 10)
labs <- c("1970", "'80","'90","2000","'10","'20")
Syear <- 1970
Fyear <- 2024# Final year to plot graphs
ii <- c( "#006140", "#00bd7d","#92f7ae", "#bdffeb" )
kk <- c( "#ba3c06", "#d4742f", "#ffa463", "#ffdec7")
jj<- c(ii,kk)
ggplot(subset(adotD.age, Sex == "Males"))+
#geom_area( aes( Year, Percentage*100, fill = Component),position = "stack", alpha =1)+
geom_bar(aes(x= Year, y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 1, alpha = 1)+
scale_fill_manual(values = jj)+
facet_wrap(~Sex)+
scale_y_continuous(breaks = seq(-10,10,by = 2), expand = c(0,0))+
scale_x_continuous(breaks = brks,labels = labs, expand = c(0,0))+
theme_minimal()+
coord_cartesian(ylim = c(-6,6), xlim=c(Syear,Fyear))+
theme(panel.grid = element_blank(),
panel.background = element_blank(),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
aspect.ratio = 1,
strip.text = element_blank(),
panel.spacing.x = unit(1,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")
ggsave("Fig/ageTermStructureDescomposition.svg", width = 2.5, height = 2)
rm(list = ls())
library(tidyverse)
library(data.table)
library(hrbrthemes)
library(msm)
library(mltools)
library(pracma)
library(splines)
library(hrbrthemes)
library(lemon)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("Decomp_FUN.R")
# Load data ---------------------------------------------------------------
# Historical data
load("C:/Git/TimeAnnuities/Data/SmoothedData.RData")
rawRates <- aRate
aRate <- rawRates[,c("Year", "delta")] # It has to be raw rate here
names(aRate)[2] <- "delta" # Smoothed delta
# Historical data
hmxr <- data.table(merge(hmx,aRate, by = "Year"))
hmxr <- hmxr[,c("country", "Sex", "Year","Age", "Mx", "delta")]
load("C:/Git/TimeAnnuities/Data/Mortality/causeOfDeathCounts.RData")
hmxr <- hmxr %>% mutate(i = case_when(Age %in% c(65:69) ~ "65",
Age %in% c(70:74) ~ "70",
Age %in% c(75:79) ~ "75",
Age %in% c(80:84) ~ "80",
Age %in% c(85:89) ~ "85",
Age %in% c(90:94) ~ "90",
Age %in% c(95:110)~ "95"))
cod <- cod %>% mutate(i = case_when(Age %in% c(65:69) ~ "65",
Age %in% c(70:74) ~ "70",
Age %in% c(75:79) ~ "75",
Age %in% c(80:84) ~ "80",
Age %in% c(85:89) ~ "85",
Age %in% c(90:94) ~ "90",
Age %in% c(95:110)~ "95"))
hmxr <- merge(hmxr, cod[,c("country","Sex","Year", "i",
"p1", "p2", "p3", "p4", "p5")],
by = c("country","Sex","Year", "i"))
smxr <- hmxr[,c("country", "Sex", "Year", "Age", "delta", "Mx", "p1","p2", "p3", "p4", "p5")]
#smxr <- hmxr # This is the full dataset
smxr <- data.table(arrange(smxr, country, Sex, Year, Age))
x <- 65 # Age to calculate annuities
Syear <- 2001
Fyear <- 2020# Final year to plot graphs
smxr <- subset(smxr, Age>=x) # Selection of interval
a <- smxr[, get.ax.cod(Age = Age, mu = Mx, delta = delta,
p1 = p1, p2 = p2, p3 = p3, p4 = p4, p5 = p5),
by = list(country,Sex, Year)]
phi <- get.phi(delta = aRate$delta, Year = aRate$Year)
rho <- a[, get.rho.cod(mu = mu, mu1 = mu1, mu2 = mu2, mu3 = mu3, mu4 = mu4, mu5 = mu5, #mu5 is Covid19
Year= Year, Age= Age), by = list(country, Sex)]
a <- merge(a, rho, by = c("country", "Sex", "Year", "Age"))
a <- merge(a, phi, by = c("Year"))
adot <- subset(a)[, get.adot(ax=ax,Year=Year), by = list(country, Sex, Age)]
names(adot)[5] <- "adotc"
# Decomposition
adotD <- a[,get.decomp.cod(Age=Age, ax=ax, sEx=sEx, mu=mu,
mu1 = mu1, mu2 = mu2, mu3 = mu3, mu4 = mu4, mu5 = mu5,
delta=delta, rho=rho,
rho1=rho1, rho2=rho2, rho3=rho3, rho4=rho4, rho5=rho5,
phi=phi, H=Hp,
H1=Hp1, H2=Hp2, H3=Hp3, H4=Hp4, H5=Hp5,
D=Dp),
by = list(country,  Sex, Year)]
adotD <- as.data.frame(arrange(adotD, country, Sex, Year))
adotD.cause <- adotD[,c("country","Sex","Year","mort1","mort2","mort3","mort4","mort5",
"int")] %>% filter() %>%
gather(Component, Percentage, -country, -Sex, -Year)
adotD.cause <- arrange(adotD.cause, Sex,  Year)
brks <- seq(1970,2020,by = 10)
labs <- c("1970", "'80","'90","2000","'10","'20")
Syear <- 2001
Fyear <- 2020# Final year to plot graphs
# Colour pallette
ii <- viridis::magma(1,alpha = 1,begin = 0.2, end =0.7,direction = -1)
kk <- viridis::viridis(5, alpha = 1, begin = 0.6, end = 1, direction = -1)
jj<- c("#76b3b8", "#542437", "#C02942", "#ECD078", "#45ba7a")  #c(ii,kk)
colores <- c("#68B3AF","#C02942","#E6AC27", "#A37E58","#254540")
adotD.cause$Component <- factor(adotD.cause$Component, levels = c("mort5","mort4","mort3","mort2","mort1", "int"))
levels(adotD.cause$Component)<- c("Other causes", "Respiratory diseases", "Cerebrovascular diseases", "Heart diseases", "Neoplasms", "Interest rates")
yearsLabels <- c('2005' = "2004 to 2005", '2010' = "2009 to 2010",
'2015' = "2014 to 2015",'2020' = "2019 to 2020")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2015,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,,2019, 2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2019,2020. 2021)))+
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2019,2020, 2021)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020))+
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020 )))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2020)))+
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2000,2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2001,2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2005,2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2018,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2018,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 1))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free"
)+ # , labeller = as_labeller(yearsLabels)
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggplot(subset(adotD.cause, Sex == "Males" & Component != "Other causes" & Year %in% c(2010,2020)))+
geom_hline(aes(yintercept = 0), colour = "black", size = 0.1, alpha =  0.8)+
geom_bar(aes(x= as.factor(Component), y = Percentage*100, fill = Component),
position = "stack", stat = "identity",width = 0.8)+
scale_y_continuous(breaks = seq(-10,10, by = 0.5))+
scale_fill_manual(values = rev(colores))+
facet_grid(.~Year, scales = "free", space = "free", labeller = as_labeller(yearsLabels)
)+ #
theme_minimal()+
coord_flip()+
theme(panel.grid = element_blank(),
panel.background = element_blank(),#element_rect(fill = "grey30"),
axis.ticks = element_line(size = 0.1, colour = "gray30"),
text = element_text(size = 7,font_rc),
panel.border = element_blank(),
legend.position = "none",
#aspect.ratio = 0.5,
strip.text = element_text(size = 7),
panel.spacing.x = unit(2,"lines"))+
ylab("Contribution to the \n change in life annuity factors (%)")+
xlab("")
ggsave("Fig/attributionCauseOfDeathInLine.svg", width = 8, height = 2)
